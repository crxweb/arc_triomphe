import requests

def getHeader(incap_session_name, incap_session_value):
    cookie = '; '.join([incap_session_name + '=' + incap_session_value])
    return {
        'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36',
        'Accept': 'application/json, text/plain, */*',
        'Accept-Language': 'en-US,en;q=0.9,fr;q=0.8',
        'Accept-Encoding': 'gzip, deflate, br',
        'Content-Type': 'application/json',
        'Cookie': cookie,
        'X-Requested-With': 'XMLHttpRequest',
        'Connection': 'keep-alive',
    }

def searchChevalByName(name,incap_session_name,incap_session_value, fake = False):
    if fake:
        ex_response = [{'NumSire': 'NnhGZ1B4bXkxSGtiYVFyMG9pN0cyQT09', 'NomCheval': 'YOUMZAIN                 ', 'Suffixe': 'IRE', 'Race': 'PS   ', 'Sexe': 'M', 'AnneeNaissance': '2003', 'link': '/fr/cheval/NnhGZ1B4bXkxSGtiYVFyMG9pN0cyQT09'}, {'NumSire': 'L1Z1bVhvZ3VMNlQ5eDdOYVJVRXU2dz09', 'NomCheval': 'ZAMBEZI SUN              ', 'Suffixe': 'GB ', 'Race': 'PS   ', 'Sexe': 'M', 'AnneeNaissance': '2004', 'link': '/fr/cheval/L1Z1bVhvZ3VMNlQ5eDdOYVJVRXU2dz09'}, {'NumSire': 'TUlnUHpYTm15RUo2Q2NVSjFqU0pDUT09', 'NomCheval': 'ASK                      ', 'Suffixe': 'GB ', 'Race': 'PS   ', 'Sexe': 'M', 'AnneeNaissance': '2003', 'link': '/fr/cheval/TUlnUHpYTm15RUo2Q2NVSjFqU0pDUT09'}, {'NumSire': 'R2VpNXlyd0cyYzBzbWVhY0dLUk8zUT09', 'NomCheval': 'SCHIAPARELLI             ', 'Suffixe': 'FR ', 'Race': 'AR   ', 'Sexe': 'F', 'AnneeNaissance': '2016', 'link': '/fr/cheval/R2VpNXlyd0cyYzBzbWVhY0dLUk8zUT09'}, {'NumSire': 'czMzdVMvOTdNaTU4V1cvaHFUeU5kZz09', 'NomCheval': 'MEISHO SAMSON            ', 'Suffixe': 'JPN', 'Race': 'PS   ', 'Sexe': 'M', 'AnneeNaissance': '2003', 'link': '/fr/cheval/czMzdVMvOTdNaTU4V1cvaHFUeU5kZz09'}, {'NumSire': 'TlVwdUJtc1N6SEFGZk1aTThYYVRGdz09', 'NomCheval': 'SOLDIER OF FORTUNE       ', 'Suffixe': 'IRE', 'Race': 'PS   ', 'Sexe': 'M', 'AnneeNaissance': '2004', 'link': '/fr/cheval/TlVwdUJtc1N6SEFGZk1aTThYYVRGdz09'}, {'NumSire': 'NUd5ZTFPNUQwNmp4OGlsY0hwOVliQT09', 'NomCheval': 'DUKE OF MARMALADE        ', 'Suffixe': 'IRE', 'Race': 'PS   ', 'Sexe': 'M', 'AnneeNaissance': '2004', 'link': '/fr/cheval/NUd5ZTFPNUQwNmp4OGlsY0hwOVliQT09'}, {'NumSire': 'OHRGVnJJcVBuaExzMGxtQld4ckRJQT09', 'NomCheval': 'PAPAL BULL               ', 'Suffixe': 'GB ', 'Race': 'PS   ', 'Sexe': 'M', 'AnneeNaissance': '2003', 'link': '/fr/cheval/OHRGVnJJcVBuaExzMGxtQld4ckRJQT09'}, {'NumSire': 'MjlMSlBkbnpHN0NCNXZ3aklVbG5jQT09', 'NomCheval': "IT'S GINO                ", 'Suffixe': 'GER', 'Race': 'PS   ', 'Sexe': 'M', 'AnneeNaissance': '2003', 'link': '/fr/cheval/MjlMSlBkbnpHN0NCNXZ3aklVbG5jQT09'}, {'NumSire': 'VERWUENCaGRhQUNZY1drMjdFNEJtZz09', 'NomCheval': 'RED ROCK CANYON          ', 'Suffixe': 'IRE', 'Race': 'PS   ', 'Sexe': 'M', 'AnneeNaissance': '2004', 'link': '/fr/cheval/VERWUENCaGRhQUNZY1drMjdFNEJtZz09'}, {'NumSire': 'OWEvTkFId2VXV0hCOG9oaERMTXE1Zz09', 'NomCheval': 'GETAWAY                  ', 'Suffixe': 'GER', 'Race': 'PS   ', 'Sexe': 'M', 'AnneeNaissance': '2003', 'link': '/fr/cheval/OWEvTkFId2VXV0hCOG9oaERMTXE1Zz09'}, {'NumSire': 'RkdjY3JKQldKa3lmQjkxaTkxNGYxUT09', 'NomCheval': "VISION D'ETAT            ", 'Suffixe': 'FR ', 'Race': 'PS   ', 'Sexe': 'M', 'AnneeNaissance': '2005', 'link': '/fr/cheval/RkdjY3JKQldKa3lmQjkxaTkxNGYxUT09'}, {'NumSire': 'Zk1YYWM4TmhwNHVqUkdzZjNsNEpEUT09', 'NomCheval': 'KAMSIN                   ', 'Suffixe': 'ITY', 'Race': 'PS   ', 'Sexe': 'H', 'AnneeNaissance': '1983', 'link': '/fr/cheval/Zk1YYWM4TmhwNHVqUkdzZjNsNEpEUT09'}, {'NumSire': 'bXN4Y3dmQ1FiOFpPUEU5TU1ZV2xRZz09', 'NomCheval': 'BLUE BRESIL              ', 'Suffixe': 'FR ', 'Race': 'PS   ', 'Sexe': 'M', 'AnneeNaissance': '2005', 'link': '/fr/cheval/bXN4Y3dmQ1FiOFpPUEU5TU1ZV2xRZz09'}, {'NumSire': 'aUtYaVhKMkJzQzFEblB5Q0NsU09hZz09', 'NomCheval': 'CIMA DE TRIOMPHE         ', 'Suffixe': 'IRE', 'Race': 'PS   ', 'Sexe': 'M', 'AnneeNaissance': '2005', 'link': '/fr/cheval/aUtYaVhKMkJzQzFEblB5Q0NsU09hZz09'}, {'NumSire': 'YWNmUDA5eEQ3dFgyNElBa3B0MlRJQT09', 'NomCheval': 'ZARKAVA                  ', 'Suffixe': 'IRE', 'Race': 'PS   ', 'Sexe': 'F', 'AnneeNaissance': '2005', 'link': '/fr/cheval/YWNmUDA5eEQ3dFgyNElBa3B0MlRJQT09'}]
        return ex_response
    else:
        url = 'https://www.france-galop.com/fr/frglp_global/ajax?module=search&mot='+name+'&type=IsRechercheCheval'
        headers = getHeader(incap_session_name, incap_session_value)
        r = requests.get(url, headers=headers)
        #@todo check exception pas de json/expired cookie
        res_horses = r.json().get('Chevaux', [])
        if len(res_horses):
            res = next((sub for sub in res_horses if sub['NomCheval'].rstrip() == name), None)
            if res:
                return res
        return None

def getChevalPerformance(id,incap_session_name,incap_session_value, fake = False):
    if fake:
        ex_response = [{"Annee":"2017","Specialite":0,"DateReunion":"20171001","NomProprietaire":"MME J. MAGNIER\/M.TABOR\/D.SMITH","NbPlace":9,"Gains":"0000000000","Prix":"QATAR PRIX DE L'ARC DE TRIOMPHE                                       ","PrimeProp":"00000000","PrimeEleveur":"00000000","PoidsPorte":"55","NomJockey":"MOORE                         ","Hippodrome":"CHANTILLY","NumProgramme":"aVluMkQ4cXNQS3JEanlXR04vR2Rkdz09","DistanceParcouru":"2400","Discipline":"P","Categorie":"GR.I      ","CategBlackType":"K","NomEntraineur":"O'BRIEN                       ","Valeur":"","NomVideo":"20171001_25564837_00000HR","TypeVideo":0,"meetingDate":{"link":"\/fr\/course\/detail\/2017\/P\/aVluMkQ4cXNQS3JEanlXR04vR2Rkdz09"},"DisciplineLitteral":"Plat"},{"Annee":"2017","Specialite":0,"DateReunion":"20170909","NomProprietaire":"","NbPlace":2,"Gains":"0000066500","Prix":"","PrimeProp":"00000000","PrimeEleveur":"00000000","PoidsPorte":"57","NomJockey":"","Hippodrome":"LEOPARDSTOWN","NumProgramme":"V2ZZd3N3M2JmV1ExeGk0NVkvSWZIdz09","DistanceParcouru":"1600","Discipline":"P","Categorie":"GR.I      ","CategBlackType":"K","NomEntraineur":"","Valeur":"540","NomVideo":"","TypeVideo":1,"meetingDate":{"link":"#"},"DisciplineLitteral":"Plat"},{"Annee":"2017","Specialite":0,"DateReunion":"20170803","NomProprietaire":"","NbPlace":1,"Gains":"0000397407","Prix":"","PrimeProp":"00000000","PrimeEleveur":"00000000","PoidsPorte":"56,5","NomJockey":"","Hippodrome":"GOODWOOD","NumProgramme":"V2ZZd3N3M2JmV1ExeGk0NVkvSWZIdz09","DistanceParcouru":"2000","Discipline":"P","Categorie":"GR.I      ","CategBlackType":"K","NomEntraineur":"","Valeur":"","NomVideo":"","TypeVideo":1,"meetingDate":{"link":"#"},"DisciplineLitteral":"Plat"},{"Annee":"2017","Specialite":0,"DateReunion":"20170623","NomProprietaire":"","NbPlace":1,"Gains":"0000284808","Prix":"","PrimeProp":"00000000","PrimeEleveur":"00000000","PoidsPorte":"57","NomJockey":"","Hippodrome":"ASCOT","NumProgramme":"V2ZZd3N3M2JmV1ExeGk0NVkvSWZIdz09","DistanceParcouru":"1600","Discipline":"P","Categorie":"GR.I      ","CategBlackType":"K","NomEntraineur":"","Valeur":"","NomVideo":"","TypeVideo":1,"meetingDate":{"link":"#"},"DisciplineLitteral":"Plat"},{"Annee":"2017","Specialite":0,"DateReunion":"20170528","NomProprietaire":"","NbPlace":1,"Gains":"0000171000","Prix":"","PrimeProp":"00000000","PrimeEleveur":"00000000","PoidsPorte":"0","NomJockey":"","Hippodrome":"CURRAGH","NumProgramme":"V2ZZd3N3M2JmV1ExeGk0NVkvSWZIdz09","DistanceParcouru":"1600","Discipline":"P","Categorie":"GR.I      ","CategBlackType":"K","NomEntraineur":"","Valeur":"","NomVideo":"","TypeVideo":1,"meetingDate":{"link":"#"},"DisciplineLitteral":"Plat"},{"Annee":"2017","Specialite":0,"DateReunion":"20170507","NomProprietaire":"","NbPlace":1,"Gains":"0000331172","Prix":"","PrimeProp":"00000000","PrimeEleveur":"00000000","PoidsPorte":"0","NomJockey":"","Hippodrome":"NEWMARKET","NumProgramme":"V2ZZd3N3M2JmV1ExeGk0NVkvSWZIdz09","DistanceParcouru":"1600","Discipline":"P","Categorie":"GR.I      ","CategBlackType":"K","NomEntraineur":"","Valeur":"","NomVideo":"","TypeVideo":1,"meetingDate":{"link":"#"},"DisciplineLitteral":"Plat"},{"Annee":"2017","Specialite":0,"DateReunion":"20170408","NomProprietaire":"","NbPlace":2,"Gains":"0000012350","Prix":"","PrimeProp":"00000000","PrimeEleveur":"00000000","PoidsPorte":"57","NomJockey":"","Hippodrome":"LEOPARDSTOWN","NumProgramme":"V2ZZd3N3M2JmV1ExeGk0NVkvSWZIdz09","DistanceParcouru":"1400","Discipline":"P","Categorie":"GR.III    ","CategBlackType":"K","NomEntraineur":"","Valeur":"","NomVideo":"","TypeVideo":1,"meetingDate":{"link":"#"},"DisciplineLitteral":"Plat"},{"Annee":"2016","Specialite":0,"DateReunion":"20160814","NomProprietaire":"","NbPlace":1,"Gains":"0000008600","Prix":"","PrimeProp":"00000000","PrimeEleveur":"00000000","PoidsPorte":"57","NomJockey":"","Hippodrome":"DUNDALK","NumProgramme":"V2ZZd3N3M2JmV1ExeGk0NVkvSWZIdz09","DistanceParcouru":"1400","Discipline":"P","Categorie":"          ","CategBlackType":"D","NomEntraineur":"","Valeur":"","NomVideo":"","TypeVideo":1,"meetingDate":{"link":"#"},"DisciplineLitteral":"Plat"},{"Annee":"2016","Specialite":0,"DateReunion":"20160723","NomProprietaire":"","NbPlace":3,"Gains":"0000001395","Prix":"","PrimeProp":"00000000","PrimeEleveur":"00000000","PoidsPorte":"57","NomJockey":"","Hippodrome":"GOWRAN PARK","NumProgramme":"V2ZZd3N3M2JmV1ExeGk0NVkvSWZIdz09","DistanceParcouru":"1600","Discipline":"P","Categorie":"          ","CategBlackType":"D","NomEntraineur":"","Valeur":"","NomVideo":"","TypeVideo":1,"meetingDate":{"link":"#"},"DisciplineLitteral":"Plat"},{"Annee":"2016","Specialite":0,"DateReunion":"20160511","NomProprietaire":"","NbPlace":3,"Gains":"0000001395","Prix":"","PrimeProp":"00000000","PrimeEleveur":"00000000","PoidsPorte":"57","NomJockey":"","Hippodrome":"NAAS","NumProgramme":"V2ZZd3N3M2JmV1ExeGk0NVkvSWZIdz09","DistanceParcouru":"1200","Discipline":"P","Categorie":"          ","CategBlackType":"D","NomEntraineur":"","Valeur":"","NomVideo":"","TypeVideo":1,"meetingDate":{"link":"#"},"DisciplineLitteral":"Plat"}]
        return ex_response
    else:
        nb_result = 100
        url = 'https://www.france-galop.com/fr/frglp_global/ajax?entraineur=0&id='+id+'&jockey=0&module=cheval_performances&nbResult='+str(nb_result)+'&proprietaire=0&specialty=4&year=0'
        headers = getHeader(incap_session_name, incap_session_value)
        r = requests.get(url, headers=headers)
        res_perf = r.json()
        return res_perf
